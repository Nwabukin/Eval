---
description: Strict TypeScript standards for both NestJS backend and Next.js frontend
globs: "**/*.ts,**/*.tsx"
alwaysApply: false
---

# Strict TypeScript Standards

## Compiler Strictness (enforced in tsconfig.json)

Both `backend/` and `frontend/` must enable:
```json
{
  "strict": true,
  "noUncheckedIndexedAccess": true,
  "noImplicitReturns": true,
  "noFallthroughCasesInSwitch": true,
  "forceConsistentCasingInFileNames": true,
  "exactOptionalPropertyTypes": true
}
```

## Hard Rules

- **No `any`** — use `unknown` and narrow, or define a proper type
- **Explicit return types** on all exported functions and public class methods
- **No type assertions** (`as`) unless accompanied by a runtime check or a comment justifying safety
- **No non-null assertions** (`!`) — handle nullability explicitly
- **Prefer `interface` for object shapes**, `type` for unions/intersections/mapped types
- **Use `readonly`** for properties that should not be reassigned after construction
- **Enums**: use `const enum` or string union types — never numeric enums without explicit values

## Patterns

```typescript
// Narrowing instead of assertion
function getUser(id: string): User | undefined {
  const user = users.get(id);
  if (!user) return undefined;
  return user;
}

// Discriminated unions for domain states
type EvaluationState =
  | { status: 'draft' }
  | { status: 'submitted_to_manager'; submittedAt: Date }
  | { status: 'submitted_to_calibration'; managerScore: number }
  | { status: 'finalized'; finalScore: number; finalizedAt: Date };
```

## Generics & Utility Types

- Use generics to avoid duplication — `ApiResponse<T>`, `PaginatedResult<T>`
- Prefer built-in utilities (`Partial`, `Pick`, `Omit`, `Record`) over manual rewriting
- Name generic parameters descriptively when non-obvious — `TEntity`, `TPayload`
